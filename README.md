# Server Monitor - SwiftBar ä¸€ä½“åŒ–æœåŠ¡å™¨ç›‘æ§æ’ä»¶

ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„SwiftBaræ’ä»¶,ç”¨äºè¿œç¨‹ç›‘æ§LinuxæœåŠ¡å™¨çš„å„é¡¹æ€§èƒ½æŒ‡æ ‡,åŒ…æ‹¬CPUã€RAMã€GPUã€ç£ç›˜ã€‚

## åŠŸèƒ½ç‰¹æ€§

âœ… **å®æ—¶ç›‘æ§**: æ¯åˆ†é’Ÿè‡ªåŠ¨æ›´æ–°æœåŠ¡å™¨çŠ¶æ€  
ğŸ¨ **æ™ºèƒ½å‘Šè­¦**: æ ¹æ®èµ„æºä½¿ç”¨ç‡è‡ªåŠ¨æ˜¾ç¤ºç»¿/é»„/çº¢ä¸‰è‰²çŠ¶æ€  
ğŸ“Š **å…¨é¢è¦†ç›–**:

- ğŸ–¥ï¸ CPUä½¿ç”¨ç‡å’Œè´Ÿè½½
- ğŸ’¾ å†…å­˜ä½¿ç”¨æƒ…å†µ
- ğŸ® GPUçŠ¶æ€(NVIDIA)
- ğŸ’¿ ç£ç›˜ç©ºé—´å’Œä½¿ç”¨ç‡

## ç³»ç»Ÿè¦æ±‚

### æœ¬åœ°ç¯å¢ƒ (Mac)

- macOS
- [SwiftBar](https://swiftbar.app/) (æ¨èé€šè¿‡Homebrewå®‰è£…: `brew install swiftbar`)
- SSHå®¢æˆ·ç«¯ (macOSè‡ªå¸¦)

### è¿œç¨‹æœåŠ¡å™¨ (Linux)

- SSHè®¿é—®æƒé™
- ä»¥ä¸‹å‘½ä»¤è¡Œå·¥å…·:
  - `top` (CPUç›‘æ§)
  - `free` (å†…å­˜ç›‘æ§)
  - `nvidia-smi` (å¯é€‰,GPUç›‘æ§)
  - `df` (ç£ç›˜ç©ºé—´)
  - `iostat` (å¯é€‰,ç£ç›˜I/O,æ¥è‡ªsysstatåŒ…)

## å®‰è£…æ­¥éª¤

### 1. å®‰è£…SwiftBar

å¦‚æœè¿˜æœªå®‰è£…SwiftBar,æ‰§è¡Œ:

```bash
brew install swiftbar
```

æˆ–ä» [SwiftBarå®˜ç½‘](https://swiftbar.app/) ä¸‹è½½å®‰è£…ã€‚

### 2. é…ç½®SSHå¯†é’¥è®¤è¯

#### ç”ŸæˆSSHå¯†é’¥ (å¦‚æœè¿˜æ²¡æœ‰)

```bash
ssh-keygen -t rsa -b 4096 -f ~/.ssh/server_monitor
```

#### å°†å…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨

```bash
ssh-copy-id -i ~/.ssh/server_monitor.pub user@your_server_ip
```

æˆ–è€…æ‰‹åŠ¨å¤åˆ¶:

```bash
cat ~/.ssh/server_monitor.pub | ssh user@your_server_ip "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

#### æµ‹è¯•SSHè¿æ¥

```bash
ssh -i ~/.ssh/server_monitor -p your_server_port user@your_server_ip
```

### 3. é…ç½®ç›‘æ§è„šæœ¬

ç¼–è¾‘ `Server_Monitor.1m.sh` æ–‡ä»¶,ä¿®æ”¹é¡¶éƒ¨çš„é…ç½®åŒºåŸŸ:

```bash
# ================= é…ç½®åŒºåŸŸ =================
HOST="your_username@your_server_ip"
PORT="22"  # SSHç«¯å£,é»˜è®¤22
ID_FILE="$HOME/.ssh/server_monitor"  # ä½ çš„SSHç§é’¥è·¯å¾„
# ===========================================
```

### 4. å®‰è£…æ’ä»¶åˆ°SwiftBar

#### æ–¹æ³•ä¸€: ä½¿ç”¨SwiftBarå®‰è£…

1. åœ¨SwiftBarä¸­ç‚¹å‡» "+" æŒ‰é’®
2. é€‰æ‹© "Add a new Plugin"
3. é€‰æ‹© `Server_Monitor.1m.sh` æ–‡ä»¶

#### æ–¹æ³•äºŒ: æ‰‹åŠ¨å®‰è£…

1. å°† `Server_Monitor.1m.sh` å¤åˆ¶åˆ°SwiftBaræ’ä»¶ç›®å½•:

   ```bash
   mkdir -p ~/.swiftbar/plugins
   cp Server_Monitor.1m.sh ~/.swiftbar/plugins/
   ```

2. ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™:

   ```bash
   chmod +x ~/.swiftbar/plugins/Server_Monitor.1m.sh
   ```

3. åœ¨SwiftBarä¸­å¯ç”¨æ’ä»¶

### 5. (å¯é€‰) å®‰è£…æœåŠ¡å™¨ç›‘æ§å·¥å…·

#### åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…å¿…è¦å·¥å…·

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y sysstat lm-sensors

# CentOS/RHEL
sudo yum install -y sysstat lm-sensors
```

#### é…ç½®sensors (æ¸©åº¦ç›‘æ§)

```bash
sudo sensors-detect
# æŒ‰æç¤ºæ“ä½œ,ä¸€èˆ¬é€‰æ‹©é»˜è®¤é€‰é¡¹å³å¯
```

## ä½¿ç”¨è¯´æ˜

### é¡¶éƒ¨æ æ˜¾ç¤º

é¡¶éƒ¨æ ä¼šæ˜¾ç¤ºæœåŠ¡å™¨çš„æ•´ä½“çŠ¶æ€:

- ğŸŸ¢ ç»¿è‰²: æ‰€æœ‰æŒ‡æ ‡æ­£å¸¸
- ğŸŸ¡ é»„è‰²: å­˜åœ¨è­¦å‘Š
- ğŸ”´ çº¢è‰²: å­˜åœ¨é”™è¯¯
- æ ¼å¼: `Server: X Errors, Y Warnings`

### ä¸‹æ‹‰èœå•è¯¦è§£

#### CPUç›‘æ§

- CPUä½¿ç”¨ç‡ç™¾åˆ†æ¯”
- è´Ÿè½½å¹³å‡å€¼ (1åˆ†é’Ÿ/5åˆ†é’Ÿ/15åˆ†é’Ÿ)
- é¢œè‰²æŒ‡ç¤º:
  - ğŸŸ¢ < 50%
  - ğŸŸ¡ 50-80%
  - ğŸ”´ > 80%

#### RAMç›‘æ§

- æ€»å†…å­˜å®¹é‡
- å·²ç”¨å†…å­˜å’Œç™¾åˆ†æ¯”
- å¯ç”¨å†…å­˜
- ç¼“å†²åŒº/ç¼“å­˜
- é¢œè‰²æŒ‡ç¤º:
  - ğŸŸ¢ < 70%
  - ğŸŸ¡ 70-90%
  - ğŸ”´ > 90%

#### GPUç›‘æ§

- å¯ç”¨/æ€»è®¡GPUæ•°é‡
- æ¯ä¸ªGPUçš„è¯¦ç»†ä¿¡æ¯:
  - åˆ©ç”¨ç‡
  - æ¸©åº¦
  - æ˜¾å­˜ä½¿ç”¨æƒ…å†µ
- é¢œè‰²æŒ‡ç¤º:
  - ğŸŸ¢ åˆ©ç”¨ç‡ < 5% ä¸”æ˜¾å­˜ > 4GBå¯ç”¨
  - ğŸ”´ å…¶ä»–æƒ…å†µ

#### ç£ç›˜ç›‘æ§

- æ˜¾ç¤ºæ‰€æœ‰æŒ‚è½½ç‚¹
- å·²ç”¨/æ€»è®¡ç©ºé—´å’Œä½¿ç”¨ç‡
- é¢œè‰²æŒ‡ç¤º:
  - ğŸŸ¢ < 70%
  - ğŸŸ¡ 70-90%
  - ğŸ”´ > 90%

### åŠŸèƒ½æŒ‰é’®

- **Refresh All**: ç«‹å³åˆ·æ–°æ‰€æœ‰ç›‘æ§æ•°æ®
- **Open Terminal**: ç›´æ¥æ‰“å¼€SSHè¿æ¥åˆ°æœåŠ¡å™¨

## è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹åˆ·æ–°é—´éš”

è„šæœ¬æ–‡ä»¶å `Server_Monitor.1m.sh` ä¸­çš„ `.1m` è¡¨ç¤ºæ¯åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡ã€‚ä½ å¯ä»¥ä¿®æ”¹ä¸º:

- `.10s` - æ¯10ç§’
- `.30s` - æ¯30ç§’
- `.5m` - æ¯5åˆ†é’Ÿ
- `.10m` - æ¯10åˆ†é’Ÿ

### ä¿®æ”¹è­¦å‘Šé˜ˆå€¼

åœ¨è„šæœ¬ä¸­æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°,ä¿®æ”¹é˜ˆå€¼æ¡ä»¶:

```bash
# ä¾‹å¦‚ä¿®æ”¹CPUé˜ˆå€¼ (åœ¨parse_cpuå‡½æ•°ä¸­)
if (( $(echo "$CPU_USAGE < 70" | bc -l) )); then  # æ”¹ä¸º70%
    CPU_STATUS="green"
    ...
```

### æ·»åŠ æ›´å¤šç›‘æ§é¡¹

ä½ å¯ä»¥æŒ‰ç…§ç°æœ‰æ¨¡å—çš„æ¨¡å¼æ·»åŠ æ–°çš„ç›‘æ§åŠŸèƒ½:

1. åœ¨è¿œç¨‹å‘½ä»¤éƒ¨åˆ†æ·»åŠ è·å–æ•°æ®çš„å‘½ä»¤
2. åˆ›å»ºæ–°çš„è§£æå‡½æ•° `parse_xxx()`
3. åœ¨èœå•è¾“å‡ºéƒ¨åˆ†æ·»åŠ æ˜¾ç¤ºé€»è¾‘

## æ•…éšœæ’æŸ¥

### è¿æ¥å¤±è´¥

**é—®é¢˜**: æ˜¾ç¤º "Server: Offline"

**è§£å†³æ–¹æ³•**:

1. æ£€æŸ¥SSHé…ç½®æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤æœåŠ¡å™¨IPå’Œç«¯å£
3. æµ‹è¯•SSHè¿æ¥: `ssh -i your_key user@server_ip`
4. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### æŸäº›æ¨¡å—æ˜¾ç¤ºç°è‰²

**é—®é¢˜**: GPUæˆ–æ¸©åº¦æ˜¾ç¤ºä¸ºç°è‰²/ä¸å¯ç”¨

**è§£å†³æ–¹æ³•**:

1. ç¡®è®¤æœåŠ¡å™¨ä¸Šå®‰è£…äº†ç›¸åº”çš„å·¥å…·
2. å¯¹äºGPU: ç¡®è®¤å·²å®‰è£…NVIDIAé©±åŠ¨å’Œnvidia-smi
3. å¯¹äºæ¸©åº¦: è¿è¡Œ `sensors-detect` å¹¶é…ç½®

### æƒé™é”™è¯¯

**é—®é¢˜**: æ— æ³•è¯»å–æŸäº›ç³»ç»Ÿä¿¡æ¯

**è§£å†³æ–¹æ³•**:

1. ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™: `chmod +x Server_Monitor.1m.sh`
2. ç¡®ä¿SSHç§é’¥æƒé™æ­£ç¡®: `chmod 600 ~/.ssh/server_monitor`

### æ•°æ®ä¸å‡†ç¡®

**é—®é¢˜**: æ˜¾ç¤ºçš„æ•°æ®ä¸å®é™…ä¸ç¬¦

**è§£å†³æ–¹æ³•**:

1. åœ¨æœåŠ¡å™¨ä¸Šæ‰‹åŠ¨è¿è¡Œå¯¹åº”çš„å‘½ä»¤æ£€æŸ¥è¾“å‡º
2. æ£€æŸ¥å‘½ä»¤è¯­æ³•æ˜¯å¦ä¸ä½ çš„ç³»ç»Ÿå…¼å®¹
3. æŸ¥çœ‹è„šæœ¬ä¸­çš„è§£æé€»è¾‘

## æ€§èƒ½ä¼˜åŒ–

### ä½¿ç”¨SSH ControlMaster

ç¼–è¾‘ `~/.ssh/config`:

```plaintext
Host your_server_ip
    ControlMaster auto
    ControlPath ~/.ssh/cm-%r@%h:%p
    ControlPersist 5m
```

è¿™æ ·å¯ä»¥å¤ç”¨SSHè¿æ¥,å‡å°‘è¿æ¥å¼€é”€ã€‚

### å‡å°‘ç›‘æ§é¢‘ç‡

å¦‚æœä¸éœ€è¦å®æ—¶æ›´æ–°,å¯ä»¥å°†åˆ·æ–°é—´éš”æ”¹ä¸º5åˆ†é’Ÿæˆ–æ›´é•¿ã€‚

### ç¦ç”¨ä¸éœ€è¦çš„æ¨¡å—

å¦‚æœä¸éœ€è¦æŸäº›ç›‘æ§åŠŸèƒ½,å¯ä»¥åœ¨è„šæœ¬ä¸­æ³¨é‡Šæ‰ç›¸å…³çš„éƒ¨åˆ†:

```bash
# ä¾‹å¦‚æ³¨é‡Šæ‰GPUç›‘æ§
# echo '===GPU==='
# nvidia-smi --query-gpu=...
```

## å®‰å…¨å»ºè®®

1. **ä½¿ç”¨å¯†é’¥è®¤è¯**: ä¸è¦ä½¿ç”¨å¯†ç è®¤è¯
2. **é™åˆ¶SSHç”¨æˆ·æƒé™**: åˆ›å»ºä¸“é—¨çš„ç›‘æ§ç”¨æˆ·,åªç»™å¿…è¦çš„æƒé™
3. **å®šæœŸæ›´æ–°å¯†é’¥**: å®šæœŸæ›´æ¢SSHå¯†é’¥
4. **ä½¿ç”¨VPN**: åœ¨å…¬ç½‘ç¯å¢ƒä¸‹å»ºè®®ä½¿ç”¨VPNè¿æ¥
5. **ç›‘æ§SSHæ—¥å¿—**: å®šæœŸæ£€æŸ¥ `/var/log/auth.log` æŸ¥çœ‹ç™»å½•è®°å½•

## è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Request!

## ç›¸å…³é“¾æ¥

- [SwiftBarå®˜ç½‘](https://swiftbar.app/)
- [SwiftBar GitHub](https://github.com/swiftbar/SwiftBar)
- [SSHå¯†é’¥ç®¡ç†æœ€ä½³å®è·µ](https://www.ssh.com/academy/ssh/key)

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜,è¯·æäº¤Issueæˆ–è”ç³»ç»´æŠ¤è€…ã€‚
